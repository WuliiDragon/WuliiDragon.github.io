<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="本文将介绍Tomcat中主要的配置文件server.xml的一些标签及其含义Tomcat隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，server.xml的每一个元素都对应了Tomcat中的一个组件；通过对xml文件中元">
    

    <!--Author-->
    
        <meta name="author" content="Dragon">
    

    <!-- Title -->
    
    <title>Tomcat 配置之 server.xml | Dragon的博客</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- Content -->
    <section class="article-container">
<!-- Back Home -->
<a class="nav-back" href="/">
    <i class="fa fa-home fa-3x"></i>
</a>

<!-- Page Header -->
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Tomcat 配置之 server.xml</h1>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h1 id="本文将介绍Tomcat中主要的配置文件server-xml的一些标签及其含义"><a href="#本文将介绍Tomcat中主要的配置文件server-xml的一些标签及其含义" class="headerlink" title="本文将介绍Tomcat中主要的配置文件server.xml的一些标签及其含义"></a>本文将介绍Tomcat中主要的配置文件server.xml的一些标签及其含义</h1><p><a href="https://baike.baidu.com/item/tomcat/255751?fr=aladdin" target="_blank" rel="external">Tomcat</a>隶属于Apache基金会，是开源的轻量级Web应用服务器，使用非常广泛。server.xml是Tomcat中最重要的配置文件，server.xml的每一个元素都对应了Tomcat中的一个组件；通过对xml文件中元素的配置，可以实现对Tomcat中各个组件的控制。因此，学习server.xml文件的配置，对于了解和使用Tomcat至关重要。</p>
<p>安装好tomcat后，在conf目录下的server.xml默认会有一些配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.startup.VersionLoggerListener"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">SSLEngine</span>=<span class="string">"on"</span></span></div><div class="line"><span class="tag">        <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JasperListener"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">auth</span>=<span class="string">"Container"</span> <span class="attr">description</span>=<span class="string">"User database that can be updated and saved"</span></span></div><div class="line"><span class="tag">            <span class="attr">factory</span>=<span class="string">"org.apache.catalina.users.MemoryUserDatabaseFactory"</span> <span class="attr">name</span>=<span class="string">"UserDatabase"</span></span></div><div class="line"><span class="tag">            <span class="attr">pathname</span>=<span class="string">"conf/tomcat-users.xml"</span> <span class="attr">type</span>=<span class="string">"org.apache.catalina.UserDatabase"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></div><div class="line"><span class="tag">            <span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.LockOutRealm"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span></span></div><div class="line"><span class="tag">                    <span class="attr">resourceName</span>=<span class="string">"UserDatabase"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"localhost"</span></span></div><div class="line"><span class="tag">                <span class="attr">unpackWARs</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span></span></div><div class="line"><span class="tag">                    <span class="attr">directory</span>=<span class="string">"logs"</span> <span class="attr">pattern</span>=<span class="string">"%h %l %u %t "</span>%<span class="attr">r</span>" %<span class="attr">s</span> %<span class="attr">b</span>" <span class="attr">prefix</span>=<span class="string">"localhost_access_log."</span></span></div><div class="line"><span class="tag">                    <span class="attr">suffix</span>=<span class="string">".txt"</span> /&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1872052-1ae934baaa245023.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>以上的就是我们要逐一介绍的节点</p>
<h2 id="Server节点"><a href="#Server节点" class="headerlink" title="Server节点"></a>Server节点</h2><p>描述：Server代表一个Tomcat实例（一个JVM）所以server.xml中唯一一个最外层的元素（唯一）</p>
<p>功能：提供接口让客户端能访问Server包含的Service，维护各个Service的生命周期等。</p>
<p>属性：</p>
<ul>
<li>port: 指定端口监听关闭tomcat的请求，设为-1可以禁掉该端口。</li>
<li>shutdown: 关闭tomcat的发送的字符串</li>
</ul>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>描述：一个Server节点可以包含多个Service节点。不同的Service所监听的端口必须是不能重复的。</p>
<p>功能：一个Service可以理解为Engine和Connector的容器。每个Connector通过一个特定的端口和协议接收入站请求交将其转发至关联的Engine进行处理。</p>
<p>属性：</p>
<ul>
<li>name:指定service 的名字<br>会默认生成一个名为Catalina的Service</li>
</ul>
<p>Service包含Connector和Engine两个节点。</p>
<h2 id="Connector"><a href="#Connector" class="headerlink" title="Connector"></a>Connector</h2><p>描述：一个Service可以包含多个Connector，Connector有多种类型</p>
<ul>
<li>HTTP连接器</li>
<li>SSL连接器</li>
<li>AJP 1.3连接器</li>
<li>proxy连接器<br>他用来表示客户端和service之间的连接。</li>
</ul>
<p>HTTP connector 示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></div><div class="line"><span class="tag">      <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></div><div class="line"><span class="tag">      <span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>SSL connector 示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8443&quot;</div><div class="line">    maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;</div><div class="line">    enableLookups=&quot;false&quot; acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;</div><div class="line">    clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; /&gt;</div></pre></td></tr></table></figure></p>
<p>AJP connector 示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div><div class="line">`</div></pre></td></tr></table></figure>
<p>在默认的Service中包含两个Connector：<br>分别是</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span><span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>此时Tomcat监听的HTTP请求，协议是HTTP/1.1，端口是8080，转发HTTPS请求到8443端口。</p>
<p>配置<code>&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot;/&gt;</code>客户端就可以通过8009端口使用AJP协议访问tomcat。</p>
<p>AJP协议：<br>AJP协议负责和其他http服务器建立连接，把tomcat服务器和其他http服务器连接时，就需要这个，之所以使用Tomcat和其他服务器集成，是因为Tomcat可以用作Servlet/JSP容器，但是对静态资源的处理速度较慢，不如Apache和IIS等HTTP服务器；因此常常将Tomcat与Apache等集成，前者作Servlet容器，后者处理静态资源，而AJP协议便负责Tomcat和Apache的连接</p>
<p>功能：接收连接请求，创建Request和Response对象用于和请求端交换数据，然后分配线程让Engine处理请求并把Request和Response对象传递给Engine</p>
<p>主要属性属性：</p>
<ul>
<li>port 指定服务器要创建的端口号，并在改端口监听客户端的请求。</li>
<li>minProcessors 服务启动时创建处理请求的线程数目。</li>
<li>maxProcessors 最大可创建的处理请求线程数目。</li>
<li>enableLookups true:进行DNS查询得到远程客户端的实际主机名 false不进行查询。s</li>
<li>redirectPort 如果某连接器支持的协议是HTTP，当接收客户端发来的HTTPS请求时，则转发至此属性定义的端口</li>
<li>connectionTimeout 等待客户端发送请求的超时时间，单位为毫秒，默认为60000，即1分钟；</li>
</ul>
<p><a href="https://tomcat.apache.org/tomcat-8.0-doc/config/http.html" target="_blank" rel="external">其他属性</a></p>
<h2 id="Engine"><a href="#Engine" class="headerlink" title="Engine"></a>Engine</h2><p>描述：一个Service 对应一个Engine。</p>
<p>功能：一个Engine从一个或者多个Connector中接收请求并处理，并将完成的响应返回给Connector。</p>
<p>主要属性：</p>
<ul>
<li>defaultHost 默认host的名字。</li>
<li>name 用于日志和错误信息，在Server中唯一</li>
<li>startStopThreads 该Engine启动子Host默认开启的线程</li>
</ul>
<h2 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h2><p>描述：一个Engine对应多个Host ，每个Host代表Engine的一个虚拟主机。Host组件至少有一个，且其中一个的name必须与Engine组件的defaultHost属性相匹配。</p>
<p>功能：运用来运行多个web应用，负责Web应用的生命周期。</p>
<p>tip: 虚拟主机是一种在一个web服务器上服务多个域名的机制，对每个域名而言，都好象独享了整个主机。实际上，大多数的小型商务网站都是采用虚拟主机实现的，这主要是因为虚拟主机能直接连接到Internet并提供相应的带宽，以保障合理的访问响应速度，另外虚拟主机还能提供一个稳定的固定IP。</p>
<p>主要属性：</p>
<ul>
<li>name 指定虚拟主机的主机名</li>
<li>unpackWARs 是否将war文件解压，true为运行解压war文件后灯文件夹，false直接运行war文件。</li>
<li>autoDeploy 是否自动部署</li>
<li>appBase 此虚拟Host的WebApp存放路径。</li>
</ul>
<p>若只配置appBase，不配Context 的docBase(appBase和docBase二选一就可以了)，则appBase的每个文件夹里都代表一个应用.这个目录下面的.war文件将被自动解压缩并部署为应用。</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>描述：一个Host可以对应多个Context，Context表示在特定的虚拟主机上运行的一个Web应用。<br>功能：</p>
<p>主要属性：</p>
<ul>
<li>path 指定Web应用的URL入口 （多指项目名）</li>
<li>docBase 指定Web应用的文件路径，可以是绝对路径，也可以是相对路径（相对该Context所在的Host的appBase属性值）</li>
<li>reloadable 若此属性为true，tomcat在运行状态下回监视WEB-INF/classes和WEB-INF/lib目录下class的文件改动，若有文件更新服务器会重载Web应用</li>
</ul>
<p><a href="https://tomcat.apache.org/tomcat-8.0-doc/config/context.html" target="_blank" rel="external">其他属性</a></p>
<p>例子：在默认Host标签中添加Context<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;</div><div class="line">     &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</div><div class="line">                       prefix=&quot;localhost_access_log.&quot; suffix=&quot;.txt&quot;</div><div class="line">                       pattern=&quot;%h %l %u %t &quot;%r&quot; %s %b&quot;/&gt;</div><div class="line">    &lt;Context path=&quot;/test&quot; reloadable=&quot;true&quot; docBase=&quot;/Users/WLW/tomcat/webapps2&quot;&gt;</div><div class="line">    </div><div class="line">    &lt;/Context&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure></p>
<p>在<code>/Users/WLW/tomcat/webapps2</code>下创建test.html。</p>
<p>访问<code>http://localhost:8080/test/test.html</code> </p>
<p><a href="http://www.jianshu.com/p/40639e2b7679" target="_blank" rel="external">参考</a></p>

 
                <!-- Meta -->
                <div class="post-meta">
                    <hr>
                    <br>
                    <div class="post-tags">
                        
                    </div>
                    <div class="post-date">
                        2017 年 09 月 24 日
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Disqus Comments -->


            </div>
        </div>
    </div>
</article>
</section>

    <!-- Scripts -->
    <!-- jQuery -->
<script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script type="text/javascript">
	console.log('Hexo-theme-hollow designed by zchen9 🙋 © 2015-' + (new Date()).getFullYear());
</script>

    <!-- Google Analytics -->
    

</body>

</html>